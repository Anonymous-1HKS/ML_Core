<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>SupML v30.0 - Visionary OS</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=VT323&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>

    <style>
      /* === 1. CORE VARIABLES (GEL OS THEME) === */
      :root {
        --primary: #0a84ff;
        --primary-glow: rgba(10, 132, 255, 0.6);
        --accent: #bf5af2;
        --success: #30d158;
        --danger: #ff453a;
        --bg-body: #d4d4d8;
        --text-main: #000;
        --text-muted: #666;
        --glass-bg: rgba(255, 255, 255, 0.65);
        --glass-border: rgba(255, 255, 255, 0.6);
        --glass-highlight: rgba(255, 255, 255, 0.8);
        --glass-blur: 60px; /* Increased blur for stronger glass effect */
        --glass-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      [data-theme="dark"] {
        --bg-body: #000;
        --text-main: #fff;
        --text-muted: #aaa;
        --glass-bg: rgba(30, 30, 35, 0.8);
        --glass-border: rgba(255, 255, 255, 0.15);
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
        outline: none;
      }
      body {
        height: 100vh;
        overflow: hidden;
        background: var(--bg-body);
        color: var(--text-main);
        transition: 0.5s;
      }

      .fluid-bg {
        position: fixed;
        inset: 0;
        z-index: -1;
        background:
          radial-gradient(circle at 10% 20%, var(--danger), transparent 40%),
          radial-gradient(circle at 90% 80%, var(--primary), transparent 40%),
          radial-gradient(circle at 50% 50%, var(--accent), transparent 50%);
        filter: blur(80px);
        opacity: 0.6;
        animation: flow 20s infinite alternate;
      }
      @keyframes flow {
        0% {
          transform: scale(1);
        }
        100% {
          transform: scale(1.15);
        }
      }

      /* === 2. UI COMPONENTS === */
      .btn-liquid {
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-main);
        transition: all 0.3s;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.8) 0%,
          rgba(255, 255, 255, 0.2) 100%
        );
        backdrop-filter: blur(var(--glass-blur));
        border: 1px solid var(--glass-border);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .btn-liquid:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      .btn-liquid.active {
        background: var(--primary);
        color: white;
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 10px 30px var(--primary-glow);
      }
      .shape-sq {
        width: 54px;
        height: 54px;
        border-radius: 18px;
        font-size: 1.3rem;
      }
      .shape-cir {
        width: 46px;
        height: 46px;
        border-radius: 50%;
      }
      .shape-pill {
        padding: 10px 24px;
        border-radius: 40px;
        font-weight: 600;
        font-size: 0.95rem;
      }

      /* === 3. LAYOUT === */
      .app-container {
        display: flex;
        height: 100vh;
        padding: 20px;
        gap: 25px;
        padding-top: 60px;
      }
      .dock {
        width: 90px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 25px 0;
        border-radius: 40px;
        z-index: 50;
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
      }
      .main-view {
        flex: 1;
        position: relative;
        border-radius: 40px;
        overflow: hidden;
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
      }
      .page {
        position: absolute;
        inset: 0;
        padding: 35px;
        display: none;
        flex-direction: column;
        animation: zoomIn 0.4s;
        overflow-y: auto;
      }
      .page.active {
        display: flex;
      }
      @keyframes zoomIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .status-bar {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 45px;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 30px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        font-weight: 600;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* === 4. CHAT SYSTEM === */
      .chat-layout {
        display: flex;
        height: 100%;
        gap: 25px;
      }
      .chat-sidebar {
        width: 280px;
        border-right: 1px solid rgba(255, 255, 255, 0.15);
        padding-right: 15px;
        display: flex;
        flex-direction: column;
      }
      .history-list {
        overflow-y: auto;
        flex: 1;
        margin-top: 15px;
      }
      .session-item {
        padding: 12px 15px;
        border-radius: 12px;
        margin-bottom: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .session-item:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .session-item.active {
        background: var(--primary);
        color: white;
      }
      .chat-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
      }
      .chat-window {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 20px;
      }
      .msg {
        display: flex;
        margin-bottom: 20px;
      }
      .msg.user {
        justify-content: flex-end;
      }
      .bubble {
        padding: 14px 22px;
        border-radius: 22px;
        max-width: 85%;
        background: rgba(255, 255, 255, 0.6);
      }
      .msg.user .bubble {
        background: var(--primary);
        color: white;
      }
      .input-area {
        background: rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(30px);
        padding: 10px;
        border-radius: 50px;
        display: flex;
        gap: 12px;
        align-items: center;
        margin-top: 15px;
        border: 1px solid var(--glass-border);
      }
      textarea {
        flex: 1;
        background: transparent;
        border: none;
        height: 28px;
        resize: none;
        color: var(--text-main);
        font-size: 1rem;
      }

      /* === 5. MACHINE LEARNING CAMERA === */
      .video-container {
        position: relative;
        width: 100%;
        height: 300px;
        background: black;
        border-radius: 20px;
        overflow: hidden;
        margin-bottom: 20px;
      }
      video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .scan-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzBGYyIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtZGFzaGFycmF5PSI1MCwyMCIvPjwvc3ZnPg==");
        opacity: 0.5;
        pointer-events: none;
      }
      .ml-result-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
      }
      .conf-bar {
        height: 6px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
        margin-top: 10px;
        overflow: hidden;
      }
      .conf-fill {
        height: 100%;
        background: var(--success);
        width: 0%;
        transition: width 0.5s;
      }

      /* === 6. SETTINGS & PROFILE === */
      .settings-container {
        overflow-y: auto;
        padding-right: 10px;
      }
      .profile-card {
        background: linear-gradient(
          135deg,
          var(--glass-highlight) 0%,
          rgba(255, 255, 255, 0.05) 100%
        );
        border: 1px solid var(--glass-border);
        border-radius: 30px;
        padding: 25px;
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }
      .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
      }
      .settings-section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 28px;
        padding: 25px;
        margin-bottom: 25px;
      }
      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 34px;
        transition: 0.4s;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        border-radius: 50%;
        transition: 0.4s;
      }
      input:checked + .slider {
        background-color: var(--success);
      }
      input:checked + .slider:before {
        transform: translateX(22px);
      }

      /* === 7. UTILS === */
      #welcome-screen {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: #000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        transition: 0.8s;
      }
      #welcome-screen.hidden {
        opacity: 0;
        pointer-events: none;
        transform: scale(1.2);
        filter: blur(20px);
      }
      .hidden {
        display: none !important;
      }
      .toast {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 12px 30px;
        border-radius: 30px;
        opacity: 0;
        transition: 0.4s;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(-10px);
      }
      #loginPage {
        position: fixed;
        inset: 0;
        z-index: 10000;
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(30px);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: 0.5s;
      }
      #loginPage.show {
        opacity: 1;
        pointer-events: all;
      }
      .login-card {
        width: 400px;
        padding: 50px;
        border-radius: 40px;
        background: rgba(255, 255, 255, 0.65);
        text-align: center;
      }
      .login-input {
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        background: rgba(255, 255, 255, 0.4);
        outline: none;
      }

      /* Code Studio */
      .code-container {
        display: flex;
        flex: 1;
        gap: 20px;
        height: 100%;
        overflow: hidden;
        margin-top: 15px;
      }
      .editor-pane,
      .output-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      .output-pane {
        background: #181818;
        border-radius: 24px;
        overflow: hidden;
      }
      .editor-wrapper {
        flex: 1;
        background: #1e1e1e;
        border-radius: 24px;
        overflow: hidden;
        display: flex;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .code-area {
        flex: 1;
        height: 100%;
        padding: 20px;
        background: transparent;
        border: none;
        resize: none;
        color: #d4d4d4;
        font-family: "JetBrains Mono";
        font-size: 14px;
        white-space: pre;
        overflow: auto;
      }
      .terminal {
        flex: 1;
        background: #0c0c0c;
        color: #30d158;
        padding: 20px;
        font-family: "VT323";
        font-size: 1.1rem;
        overflow: auto;
      }

      /* Widget Card Styles - Enhanced rounded corners and glass effect */
      .widget-card {
        padding: 20px;
        border-radius: 40px; /* Increased rounded corners */
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur)); /* Stronger glass effect */
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      /* Additional styles for world info */
      .world-weather-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-top: 20px;
      }
      .world-weather-card {
        padding: 15px;
        border-radius: 40px; /* Increased rounded corners */
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur)); /* Stronger glass effect */
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        text-align: center;
      }
      .news-list {
        margin-top: 20px;
        overflow-y: auto;
        max-height: 300px;
      }
      .news-item {
        padding: 15px;
        border-radius: 40px; /* Increased rounded corners */
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur)); /* Stronger glass effect */
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        margin-bottom: 10px;
      }
      .news-item img {
        width: 100%;
        height: auto;
        border-radius: 20px;
        margin-bottom: 10px;
      }
      .news-item h4 {
        margin-bottom: 5px;
        font-weight: 600;
      }
      .news-item p {
        font-size: 0.9rem;
        opacity: 0.8;
      }
      /* Style mới cho preview pane trong code editor */
.preview-pane {
  background: var(--glass-bg);
  border-radius: 12px;
  padding: 10px;
  margin-top: 20px;
  overflow: auto;
  max-height: 400px;
}

/* Style cho icon xóa trong chat */
.msg .fa-trash {
  cursor: pointer;
  margin-left: 10px;
  color: var(--danger);
  opacity: 0.7;
}
.msg .fa-trash:hover {
  opacity: 1;
}
    </style>
  </head>
  <body>
    <div id="welcome-screen">
      <h1
        style="
          font-size: 5rem;
          font-weight: 900;
          background: linear-gradient(135deg, #fff, #888);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
        "
      >
        SupML
      </h1>
      <p style="letter-spacing: 2px; color: #aaa; margin-bottom: 40px">
        VISIONARY EDITION
      </p>
      <button
        class="btn-liquid shape-pill"
        onclick="enterSystem()"
        style="padding: 15px 40px; font-size: 1.1rem"
      >
        INITIALIZE SYSTEM
      </button>
    </div>

    <div class="fluid-bg"></div>
    <div id="toast" class="toast">Ready</div>
    <div class="status-bar">
      <div style="display: flex; gap: 20px">
        <span id="clock">--:--</span><span id="date">--/--</span>
      </div>
      <div style="display: flex; gap: 15px">
        <i class="fa-solid fa-wifi"></i> SupML Net
        <i class="fa-solid fa-battery-full"></i>
      </div>
    </div>

    <div id="loginPage">
      <div class="login-card">
        <h1>SupML OS</h1>
        <input type="text" id="email" class="login-input" value="admin" /><input
          type="password"
          id="password"
          class="login-input"
          value="123"
        /><button
          class="btn-liquid shape-pill"
          style="width: 100%; margin-top: 20px"
          onclick="login()"
        >
          Đăng nhập
        </button>
      </div>
    </div>

    <div id="app" class="app-container hidden">
      <div class="dock">
        <button
          id="btn-dashboard"
          class="btn-liquid shape-sq active"
          onclick="nav('dashboard')"
        >
          <i class="fa-solid fa-chart-pie"></i>
        </button>
        <button id="btn-chat" class="btn-liquid shape-sq" onclick="nav('chat')">
          <i class="fa-solid fa-comments"></i>
        </button>
        <button id="btn-ml" class="btn-liquid shape-sq" onclick="nav('ml')">
          <i class="fa-solid fa-robot"></i>
        </button>
        <button id="btn-kitchen" class="btn-liquid shape-sq" onclick="nav('kitchen')">
          <i class="fa-solid fa-utensils"></i>
        </button>
        <button id="btn-code" class="btn-liquid shape-sq" onclick="nav('code')">
          <i class="fa-solid fa-code"></i>
        </button>
        <button
          id="btn-settings"
          class="btn-liquid shape-sq"
          onclick="nav('settings')"
        >
          <i class="fa-solid fa-sliders"></i>
        </button>
        <div style="flex: 1"></div>
        <button class="btn-liquid shape-cir" onclick="lockScreen()">
          <i class="fa-solid fa-lock"></i>
        </button>
      </div>

      <div class="main-view">
        <div id="page-dashboard" class="page active">
          <h1 style="font-size: 3rem; margin-bottom: 30px; font-weight: 800">
            Trung tâm điều khiển
          </h1>
          <div
            style="
              display: grid;
              grid-template-columns: 1.5fr 1fr 1fr;
              grid-template-rows: 200px 200px;
              gap: 25px;
            "
          >
            <div
              class="widget-card"
              style="grid-row: span 2; background: linear-gradient(135deg, #4facfecc 0%, #00f2fecc 100%); color: white;"
            >
              <div style="display: flex; justify-content: space-between">
                <i class="fa-solid fa-cloud-sun" style="font-size: 5rem"></i>
                <div style="text-align: right">
                  <h2>TP.HCM</h2>
                  <span id="weatherDesc">...</span>
                </div>
              </div>
              <div>
                <div class="big-text" id="weatherTemp">--°</div>
                <div class="sub-text">Cảm giác: --°</div>
              </div>
            </div>
            <div class="widget-card">
              <i class="fa-regular fa-clock" style="font-size: 1.8rem"></i>
              <div class="big-text" id="dashClock">--:--</div>
            </div>
            <div class="widget-card" style="grid-column: span 2">
              <span style="font-weight: 800; color: var(--danger)"
                >TIN NÓNG</span
              >
              <div
                id="newsTicker"
                style="font-size: 1.2rem; font-weight: 600; margin-top: 15px"
              >
                Đang tải...
              </div>
            </div>
            <div class="widget-card">
              <i class="fa-solid fa-microchip" style="font-size: 1.8rem"></i>
              <div style="font-weight: 800; font-size: 1.4rem">CPU: 12%</div>
            </div>
          </div>

          <!-- New section for world info -->
          <h2 style="margin-top: 40px; font-size: 2rem; font-weight: 700">Thông tin Thế giới</h2>
          <div class="world-weather-grid">
            <div class="world-weather-card">
              <h3>London</h3>
              <div id="londonTemp">--°</div>
              <span id="londonDesc">...</span>
            </div>
            <div class="world-weather-card">
              <h3>New York</h3>
              <div id="newyorkTemp">--°</div>
              <span id="newyorkDesc">...</span>
            </div>
            <div class="world-weather-card">
              <h3>Tokyo</h3>
              <div id="tokyoTemp">--°</div>
              <span id="tokyoDesc">...</span>
            </div>
          </div>

          <h3 style="margin-top: 30px; font-weight: 600">Tin tức VNExpress (Thời gian thực)</h3>
          <div class="news-list" id="worldNewsList">
            <!-- News items will be populated here -->
          </div>
        </div>

        <div id="page-ml" class="page">
          <h1 style="margin-bottom: 20px">AI Vision Scanner</h1>
          <div style="display: flex; gap: 20px; height: 100%">
            <div
              style="flex: 2; display: flex; flex-direction: column; gap: 15px"
            >
              <div class="video-container">
                <video id="video-stream" autoplay playsinline></video>
                <img
                  id="preview-img"
                  style="
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    display: none;
                  "
                />
                <div class="scan-overlay"></div>
              </div>
              <div style="display: flex; gap: 15px">
                <button class="btn-liquid shape-pill" onclick="startCamera()">
                  <i class="fa-solid fa-camera"></i> Bật Camera
                </button>
                <button
                  class="btn-liquid shape-pill"
                  onclick="captureAndPredict()"
                >
                  <i class="fa-solid fa-expand"></i> Quét
                </button>
                <label class="btn-liquid shape-pill"
                  ><i class="fa-solid fa-upload"></i> Upload<input
                    type="file"
                    hidden
                    onchange="handleMLUpload(this)"
                /></label>
              </div>
            </div>
            <div
              class="ml-result-card"
              style="flex: 1; display: none"
              id="ml-result"
            >
              <h3>Kết quả phân tích</h3>
              <div
                style="
                  font-size: 2rem;
                  font-weight: 800;
                  margin: 20px 0;
                  color: var(--primary);
                "
                id="result-label"
              >
                ...
              </div>
              <div
                style="font-size: 0.9rem; margin-bottom: 5px"
                id="result-conf"
              >
                Độ tin cậy: --%
              </div>
              <div class="conf-bar">
                <div class="conf-fill" id="conf-fill"></div>
              </div>
              <button
                class="btn-liquid shape-pill"
                style="
                  width: 100%;
                  margin-top: 30px;
                  background: var(--accent);
                  color: white;
                "
                onclick="askAIAboutObject()"
              >
                Hỏi AI về vật này <i class="fa-solid fa-arrow-right"></i>
              </button>
            </div>
          </div>
        </div>

        <div id="page-kitchen" class="page">
          <h1 style="margin-bottom: 20px">Kitchen Utensil Scanner</h1>
          <div style="display: flex; gap: 20px; height: 100%">
            <div
              style="flex: 2; display: flex; flex-direction: column; gap: 15px"
            >
              <div class="video-container">
                <video id="kitchen-video-stream" autoplay playsinline></video>
                <img
                  id="kitchen-preview-img"
                  style="
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    display: none;
                  "
                />
                <div class="scan-overlay"></div>
              </div>
              <div style="display: flex; gap: 15px">
                <button class="btn-liquid shape-pill" onclick="startKitchenCamera()">
                  <i class="fa-solid fa-camera"></i> Bật Camera
                </button>
                <button
                  class="btn-liquid shape-pill"
                  onclick="captureKitchenAndPredict()"
                >
                  <i class="fa-solid fa-expand"></i> Quét
                </button>
                <label class="btn-liquid shape-pill"
                  ><i class="fa-solid fa-upload"></i> Upload<input
                    type="file"
                    hidden
                    onchange="handleKitchenUpload(this)"
                /></label>
              </div>
            </div>
            <div
              class="ml-result-card"
              style="flex: 1; display: none"
              id="kitchen-result"
            >
              <h3>Kết quả phân tích</h3>
              <div
                style="
                  font-size: 2rem;
                  font-weight: 800;
                  margin: 20px 0;
                  color: var(--primary);
                "
                id="kitchen-result-label"
              >
                ...
              </div>
              <div
                style="font-size: 0.9rem; margin-bottom: 5px"
                id="kitchen-result-conf"
              >
                Độ tin cậy: --%
              </div>
              <div class="conf-bar">
                <div class="conf-fill" id="kitchen-conf-fill"></div>
              </div>
              <button
                class="btn-liquid shape-pill"
                style="
                  width: 100%;
                  margin-top: 30px;
                  background: var(--accent);
                  color: white;
                "
                onclick="askAIAboutKitchenObject()"
              >
                Hỏi AI về vật này <i class="fa-solid fa-arrow-right"></i>
              </button>
            </div>
          </div>
        </div>

        <div id="page-chat" class="page">
          <div class="chat-layout">
            <div class="chat-sidebar">
              <button
                class="btn-liquid shape-pill"
                style="width: 100%; margin-bottom: 20px"
                onclick="startNewChat()"
              >
                + Chat Mới
              </button>
              <div style="font-weight: bold; opacity: 0.6; margin-bottom: 10px">
                LỊCH SỬ
              </div>
              <div class="history-list" id="sessionsList"></div>
              <button
                class="btn-liquid shape-sq"
                style="margin-top: auto; color: var(--danger); width: 100%"
                onclick="clearHistory()"
              >
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
            <div class="chat-main">
              <div class="chat-window" id="chatWindow">
                <div class="msg ai">
                  <div class="bubble">SupML AI đã sẵn sàng.</div>
                </div>
              </div>
              <div
                class="input-area"
                style="
                  flex-direction: column;
                  align-items: stretch;
                  border-radius: 20px;
                "
              >
                <div
                  id="imagePreview"
                  style="
                    display: none;
                    padding: 10px;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                  "
                >
                  <div style="position: relative; display: inline-block">
                    <img
                      id="previewThumb"
                      src=""
                      style="
                        height: 60px;
                        border-radius: 10px;
                        border: 1px solid rgba(255, 255, 255, 0.3);
                      "
                    />
                    <button
                      onclick="removeImage()"
                      style="
                        position: absolute;
                        top: -5px;
                        right: -5px;
                        background: red;
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 20px;
                        height: 20px;
                        cursor: pointer;
                        font-size: 10px;
                      "
                    >
                      ✕
                    </button>
                  </div>
                </div>

                <div
                  style="
                    display: flex;
                    align-items: center;
                    width: 100%;
                    padding: 5px 10px;
                  "
                >
                  <label class="btn-liquid shape-cir"
                    ><i class="fa-solid fa-paperclip"></i
                    ><input
                      type="file"
                      hidden
                      id="fileInput"
                      onchange="handleFile(this)"
                  /></label>
                  <button
                    id="btn-mic"
                    class="btn-liquid shape-cir"
                    onclick="toggleVoice()"
                  >
                    <i class="fa-solid fa-microphone"></i>
                  </button>
                  <textarea
                    id="msgInput"
                    placeholder="Nhập tin nhắn..."
                    onkeydown="checkEnter(event)"
                  ></textarea>
                  <button
                    type="button"
                    class="btn-liquid shape-cir active"
                    onclick="sendMessage()"
                  >
                    <i class="fa-solid fa-arrow-up"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="page-code" class="page">
          <div class="code-container">
            <div class="editor-pane">
              <div class="editor-wrapper">
                <div class="line-numbers" id="lineNumbers">1</div>
                <textarea
                  id="codeEditor"
                  class="code-area"
                  oninput="updateLineNumbers(); livePreview()"
                >
print("Hello World")</textarea
                >
              </div>
              <button class="btn-liquid shape-pill" onclick="runCode()">
                Chạy Code (Python)
              </button>
              <!-- Selector ngôn ngữ mới -->
<select id="langSelect">
  <option value="python">Python</option>
  <option value="c">C</option>
  <option value="cpp">C++</option>
  <option value="ruby">Ruby</option>
  <option value="kotlin">Kotlin</option>
  <option value="java">Java</option>
  <option value="html">HTML</option>
  <option value="typescript">TS</option>
  <option value="rust">Rust</option>
  <!-- Thêm ngôn ngữ khác nếu cần -->
</select>

<!-- Preview pane mới cho live preview -->
<div id="preview" class="preview-pane"></div>
            </div>
            <div class="output-pane">
              <div class="terminal" id="terminalOutput">Terminal Output...</div>
              <div style="padding: 10px; background: #222; display: flex">
                <span style="color: #0f0; margin-right: 10px">$</span>
                <input
                  type="text"
                  id="termInput"
                  style="
                    background: transparent;
                    border: none;
                    color: white;
                    flex: 1;
                    font-family: &quot;VT323&quot;;
                  "
                  placeholder="Nhập lệnh (vd: pip install numpy)..."
                  onkeydown="runTerminalCommand(event)"
                />
              </div>
            </div>
          </div>
        </div>

        <div id="page-settings" class="page">
          <div class="settings-container">
            <h1>Cài đặt</h1>
            <div class="profile-card">
              <div class="profile-avatar">AD</div>
              <div><b>Admin</b><br /><small>SuperUser</small></div>
            </div>
            <!-- Tùy chỉnh giao diện và hiệu ứng mới -->
<div class="setting-row">
  <span>Mức Độ Blur (Hiệu ứng kính mờ)</span>
  <select id="blurLevel" onchange="setBlur(this.value)">
    <option value="60">Cao</option>
    <option value="30">Trung bình</option>
    <option value="10">Thấp</option>
  </select>
</div>

<div class="setting-row">
  <span>Màu Primary (Màu chính)</span>
  <input type="color" id="primaryColor" value="#0a84ff" onchange="setColor('--primary', this.value)">
</div>

<div class="setting-row">
  <span>Màu Accent (Màu nhấn)</span>
  <input type="color" id="accentColor" value="#bf5af2" onchange="setColor('--accent', this.value)">
</div>

<div class="setting-row">
  <span>Bật Hiệu Ứng Animations</span>
  <label class="switch">
    <input type="checkbox" checked onchange="toggleAnimations(this.checked)">
    <span class="slider"></span>
  </label>
</div>

<div class="setting-row">
  <span>Chủ Đề Giao Diện</span>
  <select id="themeSelect" onchange="setTheme(this.value)">
    <option value="light">Sáng</option>
    <option value="dark">Tối</option>
    <option value="auto">Tự động (theo hệ thống)</option>
  </select>
</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_URL = "http://127.0.0.1:5001/api";
      const socket = io();
      let selectedFile = null,
        currentSessionId = null,
        detectedObject = null,
        kitchenDetectedObject = null,
        kitchenSelectedFile = null;

      // 1. THÊM HÀM NÀY ĐỂ SỬA LỖI RELOAD KHI ẤN ENTER
      function checkEnter(e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault(); // Chặn xuống dòng
          sendMessage(); // Gửi tin nhắn
        }
      }

      // 1. INIT
      window.onload = function () {
        if (localStorage.getItem("isLoggedIn") === "true") {
          document.getElementById("welcome-screen").classList.add("hidden");
          document.getElementById("app").classList.remove("hidden");
          nav(localStorage.getItem("lastPage") || "dashboard");
          initSystem();
          loadSessions();
        }
        updateLineNumbers();
      };

      // 2. ML VISION LOGIC (General)
      function startCamera() {
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then((stream) => {
            const video = document.getElementById("video-stream");
            video.srcObject = stream;
            document.getElementById("preview-img").style.display = "none";
            video.style.display = "block";
          })
          .catch((e) => showToast("Lỗi Camera: " + e));
      }

      function handleMLUpload(input) {
        if (input.files[0]) {
          const file = input.files[0];
          predictImage(file, 'predict');
          document.getElementById("video-stream").style.display = "none";
          const img = document.getElementById("preview-img");
          img.style.display = "block";
          img.src = URL.createObjectURL(file);
        }
      }

      function captureAndPredict() {
        const video = document.getElementById("video-stream");

        // Kiểm tra xem camera có đang bật không
        if (video.srcObject === null) {
          showToast("Vui lòng bật Camera trước!");
          return;
        }

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        // Chuyển đổi sang định dạng JPEG rõ ràng
        canvas.toBlob(
          (blob) => {
            if (!blob) {
              showToast("Lỗi chụp ảnh!");
              return;
            }
            predictImage(blob, 'predict');
          },
          "image/jpeg",
          0.95,
        ); // Chất lượng 0.95
      }

      async function predictImage(fileBlob, endpoint) {
        const fd = new FormData();

        fd.append("file", fileBlob, "capture.jpg");
        if (endpoint === 'predict') selectedFile = fileBlob;
        else kitchenSelectedFile = fileBlob;
        const resultId = endpoint === 'predict' ? 'ml-result' : 'kitchen-result';
        const labelId = endpoint === 'predict' ? 'result-label' : 'kitchen-result-label';
        const confId = endpoint === 'predict' ? 'result-conf' : 'kitchen-result-conf';
        const fillId = endpoint === 'predict' ? 'conf-fill' : 'kitchen-conf-fill';

        document.getElementById(labelId).innerText = "Đang phân tích...";
        document.getElementById(confId).innerText = "Độ tin cậy: --%";
        document.getElementById(fillId).style.width = "0%";
        document.getElementById(resultId).style.display = "block";

        try {
          const res = await fetch(`${API_URL}/${endpoint}`, {
            method: "POST",
            body: fd,
          });
          const data = await res.json();

          if (data.error) {
            showToast("Server báo lỗi: " + data.error);
            document.getElementById(labelId).innerText = "Lỗi";
          } else {
            if (endpoint === 'predict') detectedObject = data.label;
            else kitchenDetectedObject = data.label;
            document.getElementById(labelId).innerText = data.label;
            document.getElementById(confId).innerText =
              `Độ tin cậy: ${data.confidence}%`;
            document.getElementById(fillId).style.width =
              data.confidence + "%";
          }
        } catch (e) {
          console.error(e);
          showToast("Lỗi kết nối ML: " + e);
        }
      }

      function askAIAboutObject() {
        if (detectedObject && selectedFile) {
          nav("chat");
          showPreview(selectedFile);
          document.getElementById("msgInput").value =
            `Tôi vừa vừa quét được "${detectedObject}". Hãy cho tôi biết thêm thông tin chi tiết về nó.`;
          // No auto-send
        } else {
          showToast("Chưa có ảnh hoặc vật thể để hỏi!");
        }
      }

      // Kitchen Scanner Logic
      function startKitchenCamera() {
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then((stream) => {
            const video = document.getElementById("kitchen-video-stream");
            video.srcObject = stream;
            document.getElementById("kitchen-preview-img").style.display = "none";
            video.style.display = "block";
          })
          .catch((e) => showToast("Lỗi Camera: " + e));
      }

      function handleKitchenUpload(input) {
        if (input.files[0]) {
          const file = input.files[0];
          predictImage(file, 'kitchen-predict');
          document.getElementById("kitchen-video-stream").style.display = "none";
          const img = document.getElementById("kitchen-preview-img");
          img.style.display = "block";
          img.src = URL.createObjectURL(file);
        }
      }

      function captureKitchenAndPredict() {
        const video = document.getElementById("kitchen-video-stream");

        if (video.srcObject === null) {
          showToast("Vui lòng bật Camera trước!");
          return;
        }

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        canvas.toBlob(
          (blob) => {
            if (!blob) {
              showToast("Lỗi chụp ảnh!");
              return;
            }
            predictImage(blob, 'kitchen-predict');
          },
          "image/jpeg",
          0.95,
        );
      }

      function askAIAboutKitchenObject() {
        if (kitchenDetectedObject && kitchenSelectedFile) {
          nav("chat");
          showPreview(kitchenSelectedFile);
          document.getElementById("msgInput").value =
            `Tôi vừa vừa quét được "${kitchenDetectedObject}" trong nhà bếp. Hãy cho tôi biết thêm thông tin chi tiết về nó.`;
          // No auto-send
        } else {
          showToast("Chưa có ảnh hoặc vật thể để hỏi!");
        }
      }

      // 3. CHAT & SESSION
      // 2. LẮNG NGHE TIN NHẮN TỪ AI/SERVER (Đã sửa lỗi hiển thị)
      socket.on("chat message", (data) => {
        // Luôn hiển thị phản hồi nếu có trường 'reply' từ AI
        if (data.reply) {
          const win = document.getElementById("chatWindow");

          // Xóa hiệu ứng "đang gõ" (nếu có)
          const typing = document.getElementById("ai-typing-indicator");
          if (typing) typing.remove();

          // Hiển thị tin nhắn AI
          const replyContent =
            typeof marked !== "undefined"
              ? marked.parse(data.reply)
              : data.reply;
          win.innerHTML += `<div class="msg ai"><div class="bubble">${replyContent}</div></div>`;
          win.scrollTop = win.scrollHeight;
        }
      });

      async function sendMessage() {
        const txt = document.getElementById("msgInput").value.trim();
        if (!txt && !selectedFile) return;

        const win = document.getElementById("chatWindow");
        let content = txt;

        if (selectedFile) {
          content = `<img src="${URL.createObjectURL(selectedFile)}" style="max-width:200px;border-radius:10px;"><br>${txt}`;
        }

        win.innerHTML += `<div class="msg user"><div class="bubble">${content}</div></div>`;
        document.getElementById("msgInput").value = "";
        win.scrollTop = win.scrollHeight;

        try {
          let res;
          if (selectedFile) {
            const fd = new FormData();
            fd.append("file", selectedFile);
            fd.append("message", txt);
            if (currentSessionId) fd.append("session_id", currentSessionId);
            res = await fetch(`${API_URL}/chat`, { method: "POST", body: fd });
          } else {
            res = await fetch(`${API_URL}/chat`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                message: txt,
                session_id: currentSessionId,
              }),
            });
          }

          const data = await res.json();

          if (data.session_id && data.session_id !== currentSessionId) {
            currentSessionId = data.session_id;
            localStorage.setItem("session_id", currentSessionId);
            loadSessions();
          }

          const userMsg = win.querySelector('.msg.user:last-child');
          userMsg.innerHTML += `<i class="fa-solid fa-trash" onclick="deleteMsg('${currentSessionId}', '${data.user_msg_id}', this)"></i>`;

          win.innerHTML += `<div class="msg ai"><div class="bubble">${marked.parse(data.reply || "⚠️ AI không phản hồi")}</div></div>`;
          win.scrollTop = win.scrollHeight;
        } catch (e) {
          showToast("❌ Lỗi kết nối AI");
        }

        selectedFile = null;
        removeImage();
      }

      async function loadSessions() {
        const res = await fetch(`${API_URL}/sessions`);
        const sessions = await res.json();
        const list = document.getElementById("sessionsList");
        list.innerHTML = "";
        sessions.forEach((s) => {
          list.innerHTML += `<div class="session-item" onclick="loadChat('${s.id}')"><span>${s.title}</span><i class="fa-solid fa-trash" onclick="deleteSession(event,'${s.id}')"></i></div>`;
        });
      }
      async function loadChat(id) {
        currentSessionId = id;
        loadSessions();
        const res = await fetch(`${API_URL}/sessions/${id}`);
        const msgs = await res.json();
        const win = document.getElementById("chatWindow");
        win.innerHTML = "";
        msgs.forEach((m) => {
          let trash = (m.role === 'user') ? `<i class="fa-solid fa-trash" onclick="deleteMsg('${id}', '${m.id}', this)"></i>` : '';
          win.innerHTML += `<div class="msg ${m.role}"><div class="bubble">${marked.parse(m.content)}</div>${trash}</div>`;
        });
        win.scrollTop = win.scrollHeight;
      }
      async function startNewChat() {
        currentSessionId = null;
        document.getElementById("chatWindow").innerHTML = "";
        loadSessions();
      }
      async function deleteSession(e, id) {
        e.stopPropagation();
        await fetch(`${API_URL}/sessions/${id}`, { method: "DELETE" });
        loadSessions();
      }
      async function clearHistory() {
        await fetch(`${API_URL}/delete_all`, { method: "DELETE" });
        location.reload();
      }

      // 1. Hàm xử lý khi chọn file từ máy tính
      function handleFile(input) {
        if (input.files[0]) {
          selectedFile = input.files[0];
          showPreview(selectedFile); // Hiện ảnh lên prompt
        }
      }

      // 2. Hàm hiển thị ảnh preview (MỚI)
      function showPreview(fileBlob) {
        const preview = document.getElementById("imagePreview");
        const thumb = document.getElementById("previewThumb");
        preview.style.display = "block";
        thumb.src = URL.createObjectURL(fileBlob);
      }

      // 3. Hàm xóa ảnh nếu không muốn gửi nữa (MỚI)
      function removeImage() {
        selectedFile = null;
        document.getElementById("imagePreview").style.display = "none";
        document.getElementById("fileInput").value = ""; // Reset input
      }

      // 4. CODE & TERMINAL
      // Thay thế hàm runCode cũ bằng hàm mới này
async function runCode() {
  const code = document.getElementById("codeEditor").value;
  const lang = document.getElementById("langSelect").value;
  const preview = document.getElementById("preview");
  const terminal = document.getElementById("terminalOutput");

  preview.innerHTML = ''; // Clear preview trước

  if (lang === "html") {
    preview.innerHTML = code;
    terminal.innerText += `\n> Preview updated for HTML`;
  } else {
    try {
      const res = await fetch(`${API_URL}/execute`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ lang: lang, code: code }),
      });
      const data = await res.json();
      terminal.innerText += `\n> ${data.output || data.error || "No output"}`;
    } catch (e) {
      terminal.innerText += `\n> Error executing code: ${e.message}`;
    }
  }
  terminal.scrollTop = terminal.scrollHeight;
}

// Hàm mới cho live preview (chỉ cho HTML)
function livePreview() {
  const lang = document.getElementById("langSelect").value;
  const code = document.getElementById("codeEditor").value;
  const preview = document.getElementById("preview");
  if (lang === "html") {
    preview.innerHTML = code;
  }
}
      function runTerminalCommand(e) {
        if (e.key === "Enter") {
          const cmd = e.target.value;
          const term = document.getElementById("terminalOutput");
          term.innerText += `\n$ ${cmd}`;

          if (cmd.startsWith("pip install")) {
            term.innerText += `\nDownloading ${cmd.split(" ")[2]}...\nSuccessfully installed.`;
          } else if (cmd === "clear") {
            term.innerText = "";
          } else {
            term.innerText += `\nCommand not found: ${cmd}`;
          }
          e.target.value = "";
          term.scrollTop = term.scrollHeight;
        }
      }
      function updateLineNumbers() {
        const l = document
          .getElementById("codeEditor")
          .value.split("\n").length;
        document.getElementById("lineNumbers").innerHTML = Array(l)
          .fill(0)
          .map((_, i) => `<div>${i + 1}</div>`)
          .join("");
      }

      // 5. SYSTEM UTILS
      function nav(p) {
        localStorage.setItem("lastPage", p);
        document
          .querySelectorAll(".page")
          .forEach((x) => x.classList.remove("active"));
        document.getElementById("page-" + p).classList.add("active");
        document
          .querySelectorAll(".dock button")
          .forEach((b) => b.classList.remove("active"));
        document.getElementById("btn-" + p)?.classList.add("active");
      }
      async function login() {
        localStorage.setItem("isLoggedIn", "true");
        location.reload();
      }
      function enterSystem() {
        document.getElementById("welcome-screen").classList.add("hidden");
        setTimeout(() => {
          if (localStorage.getItem("isLoggedIn") === "true") {
            document.getElementById("app").classList.remove("hidden");
            nav("dashboard");
          } else {
            document.getElementById("loginPage").classList.add("show");
          }
        }, 800);
      }
      function lockScreen() {
        document.getElementById("app").classList.add("hidden");
        document.getElementById("loginPage").classList.remove("show");
        document.getElementById("welcome-screen").classList.remove("hidden");
      }
      function toggleTheme() {
        document.body.setAttribute(
          "data-theme",
          document.body.getAttribute("data-theme") === "dark"
            ? "light"
            : "dark",
        );
      }

      // Fetch weather for a city
      async function fetchWeather(lat, lon, tempId, descId, cityName) {
        try {
          const res = await fetch(
            `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`,
          );
          const data = await res.json();
          document.getElementById(tempId).innerText =
            Math.round(data.current_weather.temperature) + "°";
          document.getElementById(descId).innerText = cityName;
        } catch (e) {
          console.error(e);
        }
      }

      // Fetch news from multiple sources
      async function fetchWorldNews() {
        const sources = [
          { name: 'BBC', url: 'https://feeds.bbci.co.uk/news/rss.xml', namespace: 'media' },
          { name: 'NYT', url: 'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml', namespace: 'media' },
          { name: 'CNN', url: 'https://rss.cnn.com/rss/cnn_world.rss', namespace: 'media' },
          { name: 'VNExpress', url: 'https://vnexpress.net/rss/tin-moi-nhat.rss', namespace: '' }
        ];
        const newsList = document.getElementById('worldNewsList');
        newsList.innerHTML = '';
        for (const source of sources) {
          try {
            const res = await fetch(source.url);
            const xmlText = await res.text();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const items = xmlDoc.getElementsByTagName('item');
            for (let i = 0; i < Math.min(5, items.length); i++) {
              const item = items[i];
              const title = item.getElementsByTagName('title')[0]?.textContent || 'No Title';
              const desc = item.getElementsByTagName('description')[0]?.textContent || 'No Description';
              let imageUrl = '';
              let thumbnail;
              if (source.name === 'VNExpress') {
                thumbnail = item.getElementsByTagName('enclosure')[0];
              } else {
                thumbnail = item.getElementsByTagName(source.namespace + ':thumbnail')[0] || item.getElementsByTagName(source.namespace + ':content')[0];
              }
              if (thumbnail) {
                imageUrl = thumbnail.getAttribute('url');
              }
              newsList.innerHTML += `
                <div class="news-item">
                  ${imageUrl ? `<img src="${imageUrl}" alt="${title}">` : ''}
                  <h4>${source.name}: ${title}</h4>
                  <p>${desc}</p>
                </div>
              `;
            }
          } catch (e) {
            console.error(`Error fetching ${source.name} news:`, e);
            newsList.innerHTML += `<p>Lỗi tải tin tức từ ${source.name}.</p>`;
          }
        }
      }

      // Update local news ticker (keep as is, or modify if needed)
      function updateNews() {
        const h = ["Gemini 2.5", "SupML OS 30", "AI Revolution"];
        const el = document.getElementById("newsTicker");
        let i = 0;
        setInterval(() => {
          el.innerText = h[i];
          i = (i + 1) % h.length;
        }, 3000);
        el.innerText = h[0];
      }

      function initSystem() {
        // Local weather (TP.HCM)
        fetchWeather(10.823, 106.6296, "weatherTemp", "weatherDesc", "TP.HCM");

        // World weather
        fetchWeather(51.5074, -0.1278, "londonTemp", "londonDesc", "London"); // London
        fetchWeather(40.7128, -74.0060, "newyorkTemp", "newyorkDesc", "New York"); // New York
        fetchWeather(35.6895, 139.6917, "tokyoTemp", "tokyoDesc", "Tokyo"); // Tokyo

        // World News with images
        fetchWorldNews();

        // Refresh world data every 30 minutes
        setInterval(() => {
          fetchWeather(10.823, 106.6296, "weatherTemp", "weatherDesc", "TP.HCM");
          fetchWeather(51.5074, -0.1278, "londonTemp", "londonDesc", "London");
          fetchWeather(40.7128, -74.0060, "newyorkTemp", "newyorkDesc", "New York");
          fetchWeather(35.6895, 139.6917, "tokyoTemp", "tokyoDesc", "Tokyo");
          fetchWorldNews();
        }, 1800000); // 30 minutes

        updateNews();
        setInterval(() => {
          const n = new Date();
          document.getElementById("clock").innerText = n.toLocaleTimeString();
          document.getElementById("dashClock").innerText =
            n.toLocaleTimeString();
          document.getElementById("date").innerText = n.toLocaleDateString();
        }, 1000);
      }
      function showToast(m) {
        const t = document.getElementById("toast");
        t.innerText = m;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 2500);
      }

      let rec;
      if ("webkitSpeechRecognition" in window) {
        rec = new webkitSpeechRecognition();
        rec.lang = "vi-VN";
        rec.continuous = false;
        rec.onresult = (e) => {
          document.getElementById("msgInput").value =
            e.results[0][0].transcript;
          setTimeout(sendMessage, 500);
        };
      }
      function toggleVoice() {
        if (rec) rec.start();
        else alert("Dùng Chrome");
      }
      // Hàm mới cho tùy chỉnh settings
function setBlur(value) {
  document.documentElement.style.setProperty('--glass-blur', `${value}px`);
}

function setColor(varName, value) {
  document.documentElement.style.setProperty(varName, value);
}

function toggleAnimations(enabled) {
  if (enabled) {
    document.body.style.transition = '0.5s'; // Bật transitions
    // Có thể thêm enable keyframes nếu cần
  } else {
    document.body.style.transition = 'none'; // Tắt transitions
    // Tắt keyframes bằng cách override animation: none !important; nếu cần
  }
}

function setTheme(value) {
  if (value === 'auto') {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    document.body.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
  } else {
    document.body.setAttribute('data-theme', value);
  }
}
// Hàm mới xóa/thu hồi tin nhắn (delete or recall)
async function deleteMsg(sessionId, msgId, el) {
  if (confirm('Xóa/thu hồi tin nhắn này?')) {
    try {
      await fetch(`${API_URL}/delete_msg/${sessionId}/${msgId}`, { method: "DELETE" });
      el.parentElement.remove();
      showToast('Tin nhắn đã được xóa');
    } catch (e) {
      showToast('Lỗi xóa tin nhắn');
    }
  }
}
    </script>
  </body>
</html>
